## A day in the life of a web request 요약

![A day in the life of a web request](https://github.com/boseungk/TIL/assets/95980754/92891802-c663-4b1c-845c-c75057801f88)

웹 페이지를 연결하기 위해서는 IP 주소와 첫 번째 hop router 주소, DNS 서버의 주소가 필요합니다. 이 정보를 얻기 위해서 DHCP 서버에게 요청을 보냅니다. DHCP 요청은 UDP, IP, Ehternet을 거쳐서 캡슐화됩니다. 그리고 LAN을 통해 로컬 네트워크의 모든 곳으로 브로드 캐스팅 됩니다. 그 중 DHCP 서버가 클라이언트 IP 주소와 첫 번째 hop router 주소, DNS 서버의 주소를 담아서 DHCP ACK에 담아서 다시 모든 로컬 네트워크로 브로드캐스팅 합니다. 그럼 쿼리를 보낸 랩탑이 그 메시지를 받아서 클라이언트 IP 주소와 첫 번째 hop router 주소, DNS 서버의 주소를 얻게 됩니다. 

이제 사용자가 HTTP 요청을 보내기 위해서 목적지의 IP 주소를 알아야 하는데, 이를 위해서  DNS Query를 만들어서 UDP, IP, Ethernet을 거쳐 캡슐화됩니다. 이것을 라우터에게 전달하기 위해서는 라우터의 mac 주소가 필요하기 때문에 그 전에 ARP 쿼리를 보내게 됩니다. 이를 통해서 라우터의 mac 주소를 알게 되고, DNS 쿼리를 보낼 수 있게 됩니다. DNS 쿼리가 첫 라우터에 도착하고 라우터에서 mac 프레임을 확인하고 분리한 후 IP 계층에서 어떤 다음 라우터로 가야하는지 찾아냅니다. 그렇게 목적지 DNS 서버까지 도착해서 DNS 서버는 그 URL에 대한 IP 주소에 대한 응답을 보내줍니다. 그럼 드디어 웹 서버로 HTTP 요청을 보낼 준비가 되었습니다.

HTTP 요청을 보내기 위해 클라이언트는 웹 서버에 대한 TCP 소켓을 엽니다. 그렇게 핸드 셰이킹을 위해 TCP SYN 세그먼트를 웹 서버로 보내게 됩니다. 웹 서버에서는 그에 대한  TCP SYNACK로 응답하게 됩니다. 그럼 그 응답을 클라이언트가 받게 되어서 TCP 연결이 이뤄지고 3-way 핸드셰이킹을 위해 다시 ACK를 보내게 되는데, 여기에 HTTP 요청을 함께 담아서 보냅니다. 클라이언트의 IP 계층에서 세그먼트에는 구글 웹서버의 목적지 주소가 적혀있고, 이 주소를 보고 다음 라우터를 결정하게 됩니다. 라우팅 과정에서 mac 주소가 필요하기 때문에 ARP 쿼리를 보내야 하지만 이미 캐싱되어 있기 때문에 별도의 ARP 쿼리 없이 바로 mac 주소를 사용할 수 있습니다. 그렇게 라우팅 되어서 웹 서버에 도착하게 되면 웹 서버는 그에 대한 HTTP 응답을 보내게 됩니다. 그럼 마침내 라우팅을 거쳐 클라이언트에게 HTTP 응답이 도착하게 됩니다.
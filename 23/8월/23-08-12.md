## Spring JPA Data 

### 벌크성 수정 쿼리

벌크성 수정 쿼리가 이해가 잘 안되었는데,

```java
public interface MemberRepository extends JpaRepository<Member, Long> {
    @Modifying
    @Query("update Member m set m.age = m.age + 1 where m.age = :age")
    int bulkAgePlus(@Param("age") int age);
}
```

이렇게 수정 쿼리를 보낸거랑 영속성 컨텍스트가 따로 노는게 이상했다.

근데 생각을 해보니까 기존에 수정 방식은 엔티티를 수정하면 영속성 컨텍스트 값을 사용하다가 트랜잭션이 종료되면 마지막에 DB로 변경된 결과를 반영해주었다.

즉 위처럼 `@Query`로 DB에 직접 Update 쿼리로 변경하면 1차 캐시에 반영이 안되는게 당연한 것이다.

그리고 JDBC나 MyBatsis 등을 사용할 때에도 JPA는 해당 결과를 알 방법이 없으니까 flush, clear를 해주는 과정이 꼭 필요하다는 것도 알 수 있었다.
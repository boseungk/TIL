## 스프링 빈

### 스프링 빈 라이프 사이클

스프링 빈은 다음과 같은 라이프 사이클을 가진다.

**객체 생성 -> 의존 관계 주입**

이 라이프 사이클을 좀더 구체적으로 살펴보면 아래와 같다.

**스프링 컨테이너 생성 -> 빈 생성 -> 의존 관계 주입 -> 초기화 콜백 -> 사용 -> 소멸전 콜백 -> 스프링 종료**

여기서 초기화 콜백과 소멸전 콜백이 의미하는 바는 다음과 같다.

* 초기화 콜백 : 빈이 생성된 후 빈의 의존관계 주입까지 완료된 후 (말 그대로 초기화 후) 호출
* 소멸전 콜백 : 빈이 소멸되기 직전에 호출

### 빈 스코프

빈 스코프란 빈이 존재할 수 있는 범위를 의미한다.

스프링은 아래와 같이 다양한 스코프를 제공한다.

* 싱글톤 : 기본 스코프로, 스프링의 컨테이너 시작과 종료까지 유지되는 스코프이다.
* 프로토 타입 : 프로토타입 빈의 생성, 의존 관계 주입까지만 빈을 관리하는 스코프이다.
* 웹 관련 스코프
  * request : 웹 요청이 들어오고 나갈때까지 유지되는 스코프
  * session : 세션이 생성되고 종료될 때까지 유지되는 스코프
  * application : 서블릿 컨텍스트와 같은 범위로 유지되는 스코프

싱글톤 스코프 위에서 다른 타입의 스코프를 사용하면 문제가 발생할 수 있다.

예를 들어서 싱글톤 스코프 위에서 프로토 타입 스코프를 사용하면 프로토 타입 빈을 요청할 때마다 새로 생성해서 주입해주는 게 아니라 한번 생성한 빈을 다시 조회해서 반환해준다.

하지만 이렇게 프로토 타입 스코프를 사용하는 것은 의도와는 다르게 된다.(이런 방식이라면 싱글톤만 사용해도 충분)

이때 지정한 프로토타입 빈을 컨테이너에서 대신 찾아주는, 즉 필요한 의존 관계를 찾는 것을 Dependency Lookup(DL)이라고 한다.

이런 기능을 위해 스프링은 ObjectProvider 클래스를 제공한다.

```java
@Autowired 
private ObjectProvider<PrototypeBean> prototypeBeanProvider;

PrototypeBean prototypeBean = prototypeBeanProvider.getObject();
```

사실 ObjectProvider를 실제로 프로토 타입 스코프를 사용하는 경우는 흔하지 않고 의존성 주입 시 순환 참조로 인해 발생하는 문제를 해결하기 위해 지연 로딩 등의 용도로 사용되곤 한다.
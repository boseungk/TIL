## SQL 튜닝 공부

SQL 문에서 항상 중복을 제거할 필요는 없다.

중복 제거에 사용되는 `DISTINCT`는 중복 제거 과정에서 **정렬 작업**과 **임시 테이블(TEMPORARY TABLE)**이 필요하기 때문에 데이터에 실제로 중복이 포함되었는지 확인하는 작업이 필요하다.

`EXPLAIN SELECT DISTINCT 사원.사원번호, 사원.이름, 사원.성, 부서관리자.부서번호 FROM 사원 JOIN 부서관리자 ON (사원.사원번호 = 부서관리자.사원번호);`

```sql
+----+-------------+------------+------------+--------+---------------+------------+---------+----------------------------+------+----------+------------------------------+
| id | select_type | table      | partitions | type   | possible_keys | key        | key_len | ref                        | rows | filtered | Extra                        |
+----+-------------+------------+------------+--------+---------------+------------+---------+----------------------------+------+----------+------------------------------+
|  1 | SIMPLE      | 부서관리자 | NULL       | index  | PRIMARY       | I_부서번호 | 12      | NULL                       |   24 |   100.00 | Using index; Using temporary |
|  1 | SIMPLE      | 사원       | NULL       | eq_ref | PRIMARY       | PRIMARY    | 4       | tuning.부서관리자.사원번호 |    1 |   100.00 | NULL                         |
+----+-------------+------------+------------+--------+---------------+------------+---------+----------------------------+------+----------+------------------------------+
```

위의 SQL문은 id가 1, 1이므로 조인이 이뤄졌다는 것을 알 수 있다. 

특히 KEY를 살펴보면 사원 번호가 PRIMARY KEY라는 것을 알 수 있는데, 기본키(PRIMARY KEY)이므로 중복된 데이터가 없으므로 중복 제거 과정이 필요 없다는 것을 알 수 있다.

따라서 `DISTINCT`를 사용할 필요가 없다.

```sql
EXPLAIN SELECT 사원.사원번호, 사원.이름, 사원.성, 부서관리자.부서번호 FROM 사원 JOIN 부서관리자 ON (사원.사원번호 = 부서관리자.사원번호);
+----+-------------+------------+------------+--------+---------------+------------+---------+----------------------------+------+----------+-------------+
| id | select_type | table      | partitions | type   | possible_keys | key        | key_len | ref                        | rows | filtered | Extra       |
+----+-------------+------------+------------+--------+---------------+------------+---------+----------------------------+------+----------+-------------+
|  1 | SIMPLE      | 부서관리자 | NULL       | index  | PRIMARY       | I_부서번호 | 12      | NULL                       |   24 |   100.00 | Using index |
|  1 | SIMPLE      | 사원       | NULL       | eq_ref | PRIMARY       | PRIMARY    | 4       | tuning.부서관리자.사원번호 |    1 |   100.00 | NULL        |
+----+-------------+------------+------------+--------+---------------+------------+---------+----------------------------+------+----------+-------------+
```

`USING TEMPORY`가 사라졌으므로 중복 제거가 발생하지 않았다는 것을 알 수 있다.